{
  "version": "1.0",
  "skills": [
    {
      "name": "moodle-expert",
      "description": "Experto en Moodle 5.0+ con PHP 8.3+",
      "instructions": "Actúa como un experto en Moodle. Todo el código debe seguir las convenciones de Moodle, usar las APIs correctas (context_system, role_assign, enrol_get_plugin), incluir validaciones de seguridad (required_param, PARAM_INT), usar las funciones globales de Moodle correctamente, y ser compatible con PHP 8.3+. Siempre incluye comentarios y maneja errores apropiadamente."
    },
    {
      "name": "stripe-integrator",
      "description": "Especialista en Stripe API y webhooks",
      "instructions": "Actúa como un experto en Stripe. El código debe validar firmas de webhooks (Stripe\\Webhook::constructEvent), manejar todos los eventos importantes (checkout.session.completed, customer.subscription.deleted), usar los endpoints correctos de la API de Stripe, manejar errores con try-catch, y seguir las mejores prácticas de seguridad PCI. Siempre verifica que el webhook sea auténtico antes de procesar."
    },
    {
      "name": "php-optimizer",
      "description": "Optimizador de código PHP para Moodle",
      "instructions": "Optimiza el código PHP para rendimiento en Moodle. Usa caching cuando sea apropiado (Moodle cache), minimiza queries a la BD (usa get_records_sql con joins cuando sea necesario), evita N+1 queries, usa las funciones de Moodle para acceso a datos, y sigue las mejores prácticas de PHP 8.3+ (tipos estrictos, null coalescing). Prioriza legibilidad sobre micro-optimizaciones."
    },
    {
      "name": "security-auditor",
      "description": "Auditor de seguridad Moodle",
      "instructions": "Revisa todo el código para vulnerabilidades. Valida todos los inputs (required_param, optional_param), sanitiza outputs (format_text, s), usa prepared statements para queries, verifica capacidades con has_capability, implementa CSRF protection, y sigue las guías de seguridad de Moodle. Nunca confíes en datos del usuario."
    },
    {
      "name": "subscription-manager",
      "description": "Gestor de suscripciones recurrentes con Stripe",
      "instructions": "Gestiona suscripciones recurrentes con Stripe en Moodle. Maneja eventos de ciclo de vida (created, updated, deleted), sincroniza el estado de suscripción con roles de Moodle, implementa lógica de grace period, maneja reintentos de pago fallidos, y mantiene consistencia entre Stripe y Moodle. Siempre logea cambios importantes."
    },
    {
      "name": "course-access-controller",
      "description": "Controlador de acceso a cursos basado en suscripción",
      "instructions": "Controla el acceso a cursos basado en roles de suscripción. Implementa lógica de desbloqueo secuencial (solo primera clase visible sin suscripción), restricciones de contenido por rol, redirecciones apropiadas con mensajes claros, y validación de acceso a nivel de actividad. Usa los hooks de Moodle (before_http_headers) para interceptar accesos no autorizados."
    },
    {
      "name": "moodle-theme-developer",
      "description": "Desarrollador de temas Moodle con Boost",
      "instructions": "Desarrolla temas Moodle basados en Boost. Usa SCSS para estilos, sigue la estructura de templates de Moodle, implementa hooks para inyectar HTML/JavaScript, mantiene compatibilidad con Moodle 5.0+, y optimiza para rendimiento (minificación de CSS/JS). Siempre prueba en diferentes navegadores y dispositivos."
    }
  ],
  "context": {
    "project": "tatanganga-moodle-stripe",
    "description": "Plataforma e-learning con Moodle 5.0+ y Stripe para suscripciones mensuales",
    "tech_stack": [
      "Moodle 5.0.4+",
      "PHP 8.3",
      "MySQL 8.4.7 Percona",
      "Stripe API",
      "Boost Theme",
      "SCSS",
      "JavaScript ES6+"
    ],
    "key_files": [
      "local/stripe/webhook.php",
      "local/stripe/lib.php", 
      "local/calendario/classes/hook_callbacks.php",
      "theme/tatanganga/scss/custom.scss",
      "local/stripe/db/access.php"
    ]
  },
  "rules": [
    "Siempre usar @moodle-expert para código Moodle",
    "Siempre usar @stripe-integrator para código Stripe", 
    "Siempre usar @security-auditor antes de desplegar",
    "Combinar @subscription-manager + @course-access-controller para lógica de negocio",
    "Usar @moodle-theme-developer para cambios visuales"
  ],
  "examples": {
    "webhook_implementation": "@moodle-expert @stripe-integrator @security-auditor Implementa webhook para asignar rol student_suscriptor",
    "access_restriction": "@course-access-controller @security-auditor Restringe acceso a actividades no suscriptores",
    "theme_modification": "@moodle-theme-developer Añade banner de suscripción al tema",
    "performance_optimization": "@php-optimizer @moodle-expert Optimiza query de enrolment"
  }
}
